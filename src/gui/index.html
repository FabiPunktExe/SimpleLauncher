<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <img id="background-image" src="background.jpg">
        <div id="logo"><img src="logo.png"><p>impleClient</p></div>
        <button id="launch" onclick="electronAPI.send('launch', document.getElementById('launch').value)" value="" disabled></button>
        <button id="account"><p style="visibility: hidden;">Click to switch</p></button>
        <img id="avatar" src="https://minotar.net/helm/mhf_question/64.png">
        <div id="versions" style="visibility: hidden;"></div>
        <div id="accounts" style="visibility: hidden;"></div>
        <script>
            const accounts = document.getElementById('accounts')
            document.getElementById('account').onclick = () => {
                if (accounts.children.length <= 1) electronAPI.send('login')
                else {
                    if (accounts.style.visibility == 'visible') accounts.style.visibility = 'hidden'
                    else accounts.style.visibility = 'visible'
                }
            }
            electronAPI.on('accounts', (event, data) => {
                if (data.length == 0) {
                    document.getElementById('launch').disabled = true
                    document.getElementById('account').value = undefined
                    document.getElementById('account').innerText = 'Login with Microsoft'
                    document.getElementById('avatar').src = 'https://minotar.net/helm/mhf_question/64.png'
                } else {
                    document.getElementById('launch').disabled = false
                    Array.from(accounts.children).filter(child => child.id != undefined).forEach(child => child.remove())
                    const changeAccount = account => {
                            document.getElementById('account').value = account.uuid
                            document.getElementById('account').innerText = account.name
                            document.getElementById('avatar').src = `https://minotar.net/helm/${account.name}/64.png`
                    }
                    for (let i = 0; i < data.length; i++) {
                        const element = array[i];
                        const button = document.createElement('button')
                        button.id = data[i].uuid
                        button.className = 'account'
                        button.innerText = data[i].name
                        button.onclick = () => changeAccount(account)
                        document.getElementById('accounts').appendChild(button)
                    }
                    changeAccount(data[data.length - 1])
                }
            })
            const versions = document.getElementById('versions')
            function clickVersionsButton() {
                if (versions.style.visibility == 'visible') versions.style.visibility = 'hidden'
                else versions.style.visibility = 'visible'
            }
        </script>
        <button id="versions-button" onclick="clickVersionsButton()"></button>
        <script>
            electronAPI.on('simpleclient_versions', (event, data) => {
                Array.from(versions.children).forEach(child => child.remove())
                const changeVersion = version => {
                        document.getElementById('launch').innerText = 'LAUNCH ' + version.minecraft_version
                        document.getElementById('versions-button').value = version.id
                        document.getElementById('versions-button').innerText = version.minecraft_version
                }
                data.forEach(version => {
                    const button = document.createElement('button')
                    button.id = version.id
                    button.className = 'version'
                    button.innerText = version.minecraft_version
                    button.onclick = () => changeVersion(version)
                    versions.appendChild(button)
                })
                changeVersion(data[data.length - 1])
            })
            window.onclick = event => {
                if (!event.target.matches('#versions-button') && versions.style.visibility == 'visible') {
                versions.style.visibility = 'hidden'
                }
            }
        </script>
    </body>
</html>